<!DOCTYPE html>

<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}


body {
font-family: 'Sylfaen', 'DejaVu Sans', 'Segoe UI', sans-serif;
background: #f5f5f5;
}

.header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 20px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header h1 {
text-align: center;
font-size: 28px;
}

.container {
max-width: 1400px;
margin: 0 auto;
padding: 20px;
}

.tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
background: white;
padding: 10px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.tab-btn {
flex: 1;
padding: 15px;
border: none;
background: #f0f0f0;
border-radius: 8px;
cursor: pointer;
font-size: 16px;
font-weight: 600;
transition: all 0.3s;
}

.tab-btn:hover {
background: #e0e0e0;
}

.tab-btn.active {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

/* Form Styles */
.booking-form-container {
background: white;
border-radius: 15px;
padding: 30px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
max-width: 900px;
margin: 0 auto;
}

.form-section-title {
font-size: 20px;
color: #667eea;
margin: 25px 0 15px 0;
padding-bottom: 10px;
border-bottom: 2px solid #667eea;
}

.form-group {
margin-bottom: 20px;
}

label {
display: block;
margin-bottom: 8px;
color: #333;
font-weight: 600;
font-size: 14px;
}

input[type="text"],
input[type="email"],
input[type="tel"],
input[type="date"],
input[type="number"],
select,
textarea {
width: 100%;
padding: 12px 15px;
border: 2px solid #e0e0e0;
border-radius: 8px;
font-size: 14px;
transition: all 0.3s;
font-family: inherit;
}

input:focus,
select:focus,
textarea:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.row {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
}

.row-3 {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 15px;
}

/* Card Styles */
.card {
background: #f8f9fa;
border: 2px solid #e0e0e0;
border-radius: 10px;
padding: 20px;
margin-bottom: 20px;
}

.card-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.card-header h4 {
color: #667eea;
font-size: 18px;
}

/* Buttons */
.btn {
padding: 10px 20px;
border: none;
border-radius: 8px;
cursor: pointer;
font-size: 14px;
font-weight: 600;
transition: all 0.3s;
}

.btn-primary {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
}

.btn-primary:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.btn-success {
background: #28a745;
color: white;
}

.btn-success:hover {
background: #218838;
}

.btn-danger {
background: #dc3545;
color: white;
}

.btn-danger:hover {
background: #c82333;
}

.btn-info {
background: #17a2b8;
color: white;
}

.btn-warning {
background: #ffc107;
color: #000;
}

.btn-full {
width: 100%;
padding: 15px;
font-size: 16px;
}

.add-btn {
width: 100%;
margin-bottom: 20px;
}

.remove-btn {
padding: 8px 15px;
font-size: 14px;
}

/* Price Display */
.price-breakdown {
background: #fff;
border: 2px solid #667eea;
border-radius: 8px;
padding: 15px;
margin-top: 20px;
}

.price-breakdown h4 {
color: #667eea;
margin-bottom: 10px;
}

.price-item {
display: flex;
justify-content: space-between;
padding: 8px 0;
border-bottom: 1px solid #e0e0e0;
}

.price-item:last-child {
border-bottom: none;
font-weight: bold;
font-size: 18px;
color: #667eea;
margin-top: 10px;
padding-top: 15px;
border-top: 2px solid #667eea;
}

.price-display {
background: #f8f9fa;
padding: 15px;
border-radius: 8px;
text-align: center;
margin-top: 10px;
}

.price-amount {
font-size: 32px;
color: #667eea;
font-weight: bold;
}

/* Table Styles */
table {
width: 100%;
background: white;
border-radius: 10px;
overflow: hidden;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
border-collapse: collapse;
}

thead {
background: #667eea;
color: white;
}

th {
padding: 15px;
text-align: left;
font-weight: 600;
font-size: 14px;
}

td {
padding: 15px;
border-bottom: 1px solid #e0e0e0;
font-size: 14px;
}

tbody tr:hover {
background: #f8f9fa;
}

.status {
padding: 5px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
display: inline-block;
}

.status.confirmed {
background: #d4edda;
color: #155724;
}

.status.checked_in {
background: #cce5ff;
color: #004085;
}

.status.checked_out {
background: #d1ecf1;
color: #0c5460;
}

.status.cancelled {
background: #f8d7da;
color: #721c24;
}

.actions {
display: flex;
gap: 5px;
flex-wrap: wrap;
}

.action-btn {
padding: 6px 12px;
font-size: 12px;
border-radius: 5px;
}

/* Modal Styles */
.modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.5);
overflow-y: auto;
}

.modal.show {
display: flex;
align-items: center;
justify-content: center;
}

.modal-content {
background: white;
padding: 30px;
border-radius: 15px;
max-width: 800px;
width: 90%;
max-height: 90vh;
overflow-y: auto;
position: relative;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 2px solid #667eea;
}

.modal-header h2 {
color: #667eea;
}

.close-btn {
background: #dc3545;
color: white;
border: none;
padding: 8px 15px;
border-radius: 5px;
cursor: pointer;
font-size: 16px;
}

.info-grid {
display: grid;
gap: 15px;
margin-bottom: 20px;
}

.info-row {
display: flex;
padding: 10px;
background: #f8f9fa;
border-radius: 5px;
}

.info-label {
font-weight: 600;
color: #666;
min-width: 150px;
}

.info-value {
color: #333;
flex: 1;
}

/* Messages */
.success-message {
background: #2ecc71;
color: white;
padding: 15px;
border-radius: 8px;
text-align: center;
margin-bottom: 20px;
display: none;
}

.success-message.show {
display: block;
animation: slideDown 0.3s ease;
}

.error-message {
color: #e74c3c;
font-size: 12px;
margin-top: 5px;
display: none;
}

.error-message.show {
display: block;
}

input.error,
select.error {
border-color: #e74c3c;
}

@keyframes slideDown {
from {
opacity: 0;
transform: translateY(-10px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

.checkbox-group label {
font-weight: normal;
display: flex;
align-items: center;
cursor: pointer;
margin-bottom: 8px;
}

.checkbox-group input[type="checkbox"] {
width: auto;
margin-right: 8px;
}

.filters {
background: white;
padding: 20px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
margin-bottom: 20px;
display: flex;
gap: 15px;
flex-wrap: wrap;
}

.loading {
text-align: center;
padding: 50px;
font-size: 18px;
color: #666;
}

.no-data {
text-align: center;
padding: 50px;
color: #999;
background: white;
border-radius: 10px;
}

@media print {
body * {
visibility: hidden;
}
.print-area, .print-area * {
visibility: visible;
}
.print-area {
position: absolute;
left: 0;
top: 0;
width: 100%;
}
}

@media (max-width: 768px) {
.row, .row-3 {
grid-template-columns: 1fr;
}

.tabs {
flex-direction: column;
}

table {
font-size: 12px;
}

th, td {
padding: 8px 5px;
}

.actions {
flex-direction: column;
}

.action-btn {
width: 100%;
}
}

/* Autocomplete */
.ac-dropdown { display:none; position:absolute; top:100%; left:0; right:0; background:white; border:2px solid #667eea; border-top:none; border-radius:0 0 6px 6px; max-height:200px; overflow-y:auto; z-index:100; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
.ac-dropdown.show { display:block; }
.ac-item { padding:8px 12px; cursor:pointer; font-size:13px; border-bottom:1px solid #f0f0f0; }
.ac-item:hover { background:#e8f0fe; }
.ac-item .ac-name { font-weight:600; color:#2c3e50; }
.ac-item .ac-detail { font-size:11px; color:#888; margin-top:2px; }
</style>


</head>
<body>
<div class="header">
<h1>ğŸ¨ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜</h1>
</div>


<div class="container">
<div class="tabs">
<button class="tab-btn active" onclick="switchTab('new-booking', this)">â• áƒáƒ®áƒáƒšáƒ˜ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ</button>
<button class="tab-btn" onclick="switchTab('bookings-list', this)">ğŸ“‹ áƒ¯áƒáƒ•áƒ¨áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ</button>
</div>

<div class="success-message" id="successMessage"></div>

<!-- Tab 1: New Booking Form -->
<div id="new-booking" class="tab-content active">
<div class="booking-form-container">
<h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">áƒáƒ®áƒáƒšáƒ˜ áƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ</h2>

<form id="bookingForm">
<!-- Client Information -->
<div class="form-section-title">áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</div>

<div class="form-group">
<label for="clientType">áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜ *</label>
<select id="clientType" name="clientType">
<option value="individual">áƒ¤áƒ˜áƒ–áƒ˜áƒ™áƒ£áƒ áƒ˜ áƒáƒ˜áƒ áƒ˜</option>
<option value="agency">áƒ¢áƒ£áƒ áƒ˜áƒ¡áƒ¢áƒ£áƒšáƒ˜ áƒ¡áƒáƒáƒ’áƒ”áƒœáƒ¢áƒ</option>
<option value="company">áƒ™áƒáƒ›áƒáƒáƒœáƒ˜áƒ</option>
</select>
</div>

<div class="form-group" style="position:relative;">
<label for="clientName">áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜/áƒ“áƒáƒ¡áƒáƒ®áƒ”áƒšáƒ”áƒ‘áƒ *</label>
<input type="text" id="clientName" name="clientName" placeholder="áƒ›áƒáƒ’: áƒ’áƒ˜áƒáƒ áƒ’áƒ˜ áƒ›áƒ”áƒšáƒáƒ«áƒ” áƒáƒœ Travel Georgia LTD" autocomplete="off">
<div class="ac-dropdown" id="acDropdownName"></div>
<span class="error-message" id="clientNameError">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</span>
</div>

<div class="row-3">
<div class="form-group" style="position:relative;">
<label for="clientIdCode">áƒ¡áƒáƒ˜áƒ“áƒ”áƒœáƒ¢áƒ˜áƒ¤áƒ˜áƒ™áƒáƒªáƒ˜áƒ áƒ™áƒáƒ“áƒ˜</label>
<input type="text" id="clientIdCode" name="clientIdCode" placeholder="áƒ›áƒáƒ’: 445418423 áƒáƒœ 01001012345" autocomplete="off">
<div class="ac-dropdown" id="acDropdownCode"></div>
</div>
<div class="form-group">
<label for="clientEmail">áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ *</label>
<input type="email" id="clientEmail" name="clientEmail" placeholder="example@mail.com">
<span class="error-message" id="clientEmailError">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¡áƒ¬áƒáƒ áƒ˜ áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ</span>
</div>

<div class="form-group">
<label for="clientPhone">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜ *</label>
<input type="tel" id="clientPhone" name="clientPhone" placeholder="+995 555 123 456">
<span class="error-message" id="clientPhoneError">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</span>
</div>
</div>

<!-- Guests Information -->
<div class="form-section-title">áƒ¡áƒ¢áƒ£áƒ›áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</div>

<div id="guestsContainer">
<!-- Guest 1 (default) -->
<div class="card" data-guest-index="1">
<div class="card-header">
<h4>áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜ #1</h4>
<button type="button" class="btn btn-danger remove-btn" onclick="removeGuest(1)" style="display: none;">âŒ áƒ¬áƒáƒ¨áƒšáƒ</button>
</div>

<div class="row">
<div class="form-group">
<label for="guestName1">áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ“áƒ áƒ’áƒ•áƒáƒ áƒ˜ *</label>
<input type="text" id="guestName1" name="guestName1" placeholder="áƒ›áƒáƒ’: áƒœáƒ˜áƒœáƒ áƒ‘áƒ”áƒ áƒ˜áƒ«áƒ”">
<span class="error-message" id="guestName1Error">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</span>
</div>

<div class="form-group">
<label for="guestIdNumber1">áƒáƒ˜áƒ áƒáƒ“áƒ˜ áƒœáƒáƒ›áƒ”áƒ áƒ˜ *</label>
<input type="text" id="guestIdNumber1" name="guestIdNumber1" placeholder="áƒ›áƒáƒ’: 01001012345">
<span class="error-message" id="guestIdNumber1Error">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒáƒ˜áƒ áƒáƒ“áƒ˜ áƒœáƒáƒ›áƒ”áƒ áƒ˜</span>
</div>
</div>

<div class="row">
<div class="form-group">
<label for="guestCountry1">áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ *</label>
<select id="guestCountry1" name="guestCountry1">
<option value="">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ</option>
<option value="georgia">áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ</option>
<option value="russia">áƒ áƒ£áƒ¡áƒ”áƒ—áƒ˜</option>
<option value="turkey">áƒ—áƒ£áƒ áƒ¥áƒ”áƒ—áƒ˜</option>
<option value="armenia">áƒ¡áƒáƒ›áƒ®áƒ”áƒ—áƒ˜</option>
<option value="azerbaijan">áƒáƒ–áƒ”áƒ áƒ‘áƒáƒ˜áƒ¯áƒáƒœáƒ˜</option>
<option value="ukraine">áƒ£áƒ™áƒ áƒáƒ˜áƒœáƒ</option>
<option value="usa">áƒáƒ¨áƒ¨</option>
<option value="uk">áƒ“áƒ˜áƒ“áƒ˜ áƒ‘áƒ áƒ˜áƒ¢áƒáƒœáƒ”áƒ—áƒ˜</option>
<option value="germany">áƒ’áƒ”áƒ áƒ›áƒáƒœáƒ˜áƒ</option>
<option value="france">áƒ¡áƒáƒ¤áƒ áƒáƒœáƒ’áƒ”áƒ—áƒ˜</option>
<option value="israel">áƒ˜áƒ¡áƒ áƒáƒ”áƒšáƒ˜</option>
<option value="china">áƒ©áƒ˜áƒœáƒ”áƒ—áƒ˜</option>
<option value="india">áƒ˜áƒœáƒ“áƒáƒ”áƒ—áƒ˜</option>
<option value="other">áƒ¡áƒ®áƒ•áƒ</option>
</select>
<span class="error-message" id="guestCountry1Error">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒáƒ˜áƒ áƒ©áƒ˜áƒáƒ— áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ</span>
</div>

<div class="form-group">
<label for="guestPhone1">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜ (áƒáƒ áƒáƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜)</label>
<input type="tel" id="guestPhone1" name="guestPhone1" placeholder="+995 555 123 456">
</div>
</div>
</div>
</div>

<button type="button" class="btn btn-success add-btn" onclick="addGuest()">â• áƒ“áƒáƒáƒ›áƒáƒ¢áƒ” áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜</button>

<!-- Dates -->
<div class="form-section-title">áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜</div>

<div class="row">
<div class="form-group">
<label for="checkIn">áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ *</label>
<input type="date" id="checkIn" name="checkIn">
<span class="error-message" id="checkInError">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒáƒ˜áƒ áƒ©áƒ˜áƒáƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜</span>
</div>

<div class="form-group">
<label for="checkOut">áƒ’áƒáƒ¡áƒ•áƒšáƒ *</label>
<input type="date" id="checkOut" name="checkOut">
<span class="error-message" id="checkOutError">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒáƒ˜áƒ áƒ©áƒ˜áƒáƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜</span>
</div>
</div>

<!-- Rooms -->
<div class="form-section-title">áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒ áƒ©áƒ”áƒ•áƒ</div>

<div id="roomsContainer">
<!-- Room 1 (default) -->
<div class="card" data-room-index="1">
<div class="card-header">
<h4>áƒáƒ—áƒáƒ®áƒ˜ #1</h4>
<button type="button" class="btn btn-danger remove-btn" onclick="removeRoom(1)" style="display: none;">âŒ áƒ¬áƒáƒ¨áƒšáƒ</button>
</div>

<div class="row">
<div class="form-group">
<label for="roomType1">áƒáƒ—áƒáƒ®áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜ *</label>
<select id="roomType1" name="roomType1">
<option value="">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ—áƒáƒ®áƒ˜</option>
<option value="single">Single - áƒ”áƒ áƒ—áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜</option>
<option value="double">Double - áƒáƒ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜ (áƒ”áƒ áƒ—áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜)</option>
<option value="twin">Twin - áƒáƒ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜ (áƒáƒ áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜)</option>
<option value="triple">Triple - áƒ¡áƒáƒ›áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜</option>
<option value="lux">LUX - áƒšáƒ£áƒ¥áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜</option>
<option value="extra_bed">Extra Bed - áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜</option>
</select>
<span class="error-message" id="roomType1Error">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ—áƒáƒ®áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜</span>
</div>

<div class="form-group">
<label for="roomPrice1">áƒ¤áƒáƒ¡áƒ˜ (áƒš/áƒ¦áƒáƒ›áƒ”) *</label>
<input type="number" id="roomPrice1" name="roomPrice1" min="0" step="0.01" placeholder="áƒ›áƒáƒ’: 150">
<span class="error-message" id="roomPrice1Error">áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¤áƒáƒ¡áƒ˜</span>
</div>
</div>

<div class="form-group">
<label for="roomNotes1">áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ (áƒáƒ áƒáƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜)</label>
<input type="text" id="roomNotes1" name="roomNotes1" placeholder="áƒ›áƒáƒ’: áƒ–áƒ¦áƒ•áƒ˜áƒ¡ áƒ®áƒ”áƒ“áƒ˜áƒ—">
</div>
</div>
</div>

<button type="button" class="btn btn-success add-btn" onclick="addRoom()">â• áƒ“áƒáƒáƒ›áƒáƒ¢áƒ” áƒáƒ—áƒáƒ®áƒ˜</button>

<!-- Services -->
<div class="form-section-title">áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ”áƒ‘áƒ˜</div>

<div class="checkbox-group">
<label>
<input type="checkbox" name="services" value="breakfast" data-price="15">
áƒ¡áƒáƒ£áƒ–áƒ›áƒ” (+15áƒš/áƒ“áƒ¦áƒ”)
</label>
<label>
<input type="checkbox" name="services" value="parking" data-price="15">
áƒáƒáƒ áƒ™áƒ˜áƒœáƒ’áƒ˜ (+15áƒš/áƒ“áƒ¦áƒ”)
</label>
<label>
<input type="checkbox" name="services" value="spa" data-price="50">
áƒ¡áƒáƒ áƒªáƒ”áƒœáƒ¢áƒ áƒ˜ (+50áƒš/áƒ“áƒ¦áƒ”)
</label>
</div>

<!-- Price Display -->
<div class="price-breakdown">
<h4>áƒ¤áƒáƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜:</h4>
<div id="priceBreakdown"><p style="color: #999;">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜</p></div>
</div>

<div class="price-display">
<h3>áƒ¡áƒ£áƒš áƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒ“áƒ”áƒšáƒ˜:</h3>
<div class="price-amount" id="totalPrice">0áƒš</div>
</div>

<button type="submit" class="btn btn-primary btn-full">ğŸ’¾ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ</button>
</form>
</div>
</div>

<!-- Tab 2: Bookings List -->
<div id="bookings-list" class="tab-content">
<div class="filters">
<input type="text" id="searchEmail" placeholder="áƒ«áƒ”áƒ‘áƒœáƒ áƒ”áƒš.áƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ—...">
<input type="date" id="filterDate" placeholder="áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜">
<select id="filterStatus">
<option value="">áƒ§áƒ•áƒ”áƒšáƒ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜</option>
<option value="confirmed">áƒ“áƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
<option value="checked_in">áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
<option value="checked_out">áƒ’áƒáƒ¡áƒ£áƒšáƒ˜</option>
<option value="cancelled">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
</select>
<button class="btn btn-primary" onclick="loadBookings()">ğŸ” áƒ¤áƒ˜áƒšáƒ¢áƒ áƒáƒªáƒ˜áƒ</button>
<button class="btn btn-warning" onclick="clearFilters()">âŒ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</button>
</div>

<div id="loadingMessage" class="loading">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</div>

<table id="bookingsTable" style="display: none;">
<thead>
<tr>
<th>áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜</th>
<th>áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜</th>
<th>áƒ”áƒš.áƒ¤áƒáƒ¡áƒ¢áƒ</th>
<th>áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ</th>
<th>áƒ’áƒáƒ¡áƒ•áƒšáƒ</th>
<th>áƒ—áƒáƒœáƒ®áƒ</th>
<th>áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜</th>
<th>áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ”áƒ‘áƒ˜</th>
</tr>
</thead>
<tbody id="bookingsTableBody">
</tbody>
</table>

<div id="noDataMessage" class="no-data" style="display: none;">
áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ”áƒ‘áƒ˜ áƒáƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ
</div>
</div>
</div>

<!-- View Modal -->
<div id="viewModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>ğŸ“„ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜</h2>
<button class="close-btn" onclick="closeViewModal()">âœ•</button>
</div>
<div id="viewModalContent"></div>
</div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>âœï¸ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</h2>
<button class="close-btn" onclick="closeEditModal()">âœ•</button>
</div>
<div id="editModalContent"></div>
</div>
</div>

<script>
let roomCount = 1;
let guestCount = 1;
let currentBookingData = null;

document.addEventListener('DOMContentLoaded', function() {
initializeForm();
});

function initializeForm() {
const form = document.getElementById('bookingForm');
const checkInInput = document.getElementById('checkIn');
const checkOutInput = document.getElementById('checkOut');
const servicesCheckboxes = document.querySelectorAll('input[name="services"]');

// Set minimum date to today
const today = new Date().toISOString().split('T')[0];
checkInInput.min = today;
checkOutInput.min = today;

checkInInput.addEventListener('change', function() {
checkOutInput.min = this.value;
calculatePrice();
});

checkOutInput.addEventListener('change', calculatePrice);
servicesCheckboxes.forEach(cb => cb.addEventListener('change', calculatePrice));

addRoomEventListeners(1);

form.addEventListener('submit', handleFormSubmit);
}

function addRoomEventListeners(roomIndex) {
const roomType = document.getElementById(`roomType${roomIndex}`);
const roomPrice = document.getElementById(`roomPrice${roomIndex}`);

if (roomType) roomType.addEventListener('change', calculatePrice);
if (roomPrice) roomPrice.addEventListener('input', calculatePrice);
}

function calculatePrice() {
const checkIn = new Date(document.getElementById('checkIn').value);
const checkOut = new Date(document.getElementById('checkOut').value);
const totalPriceElement = document.getElementById('totalPrice');
const breakdownElement = document.getElementById('priceBreakdown');

if (!document.getElementById('checkIn').value || !document.getElementById('checkOut').value) {
totalPriceElement.textContent = '0áƒš';
breakdownElement.innerHTML = '<p style="color: #999;">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜</p>';
return;
}

const nights = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));

if (nights <= 0) {
totalPriceElement.textContent = '0áƒš';
breakdownElement.innerHTML = '<p style="color: #999;">áƒ’áƒáƒ¡áƒ•áƒšáƒ˜áƒ¡ áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’</p>';
return;
}

let totalRoomsPrice = 0;
let breakdownHTML = '';

// Calculate rooms
for (let i = 1; i <= roomCount; i++) {
const roomCard = document.querySelector(`[data-room-index="${i}"]`);
if (!roomCard) continue;

const roomType = document.getElementById(`roomType${i}`);
const roomPrice = document.getElementById(`roomPrice${i}`);

if (roomType && roomType.value && roomPrice && roomPrice.value) {
const price = parseFloat(roomPrice.value) || 0;
const roomTotal = price * nights;
totalRoomsPrice += roomTotal;

const roomTypeName = roomType.options[roomType.selectedIndex].text;
breakdownHTML += `
<div class="price-item">
<span>áƒáƒ—áƒáƒ®áƒ˜ #${i} (${roomTypeName}): ${price}áƒš Ã— ${nights} áƒ¦áƒáƒ›áƒ”</span>
<span>${roomTotal}áƒš</span>
</div>
`;
}
}

// Calculate services
let servicesPrice = 0;
const servicesCheckboxes = document.querySelectorAll('input[name="services"]');
servicesCheckboxes.forEach(cb => {
if (cb.checked) {
const servicePrice = parseInt(cb.dataset.price) || 0;
const serviceTotal = servicePrice * nights;
servicesPrice += serviceTotal;

let serviceName = '';
if (cb.value === 'breakfast') serviceName = 'áƒ¡áƒáƒ£áƒ–áƒ›áƒ”';
if (cb.value === 'parking') serviceName = 'áƒáƒáƒ áƒ™áƒ˜áƒœáƒ’áƒ˜';
if (cb.value === 'spa') serviceName = 'áƒ¡áƒáƒ áƒªáƒ”áƒœáƒ¢áƒ áƒ˜';

breakdownHTML += `
<div class="price-item">
<span>${serviceName}: ${servicePrice}áƒš Ã— ${nights} áƒ“áƒ¦áƒ”</span>
<span>${serviceTotal}áƒš</span>
</div>
`;
}
});

const grandTotal = totalRoomsPrice + servicesPrice;

if (breakdownHTML) {
breakdownHTML += `
<div class="price-item">
<span>áƒ¡áƒ£áƒš:</span>
<span>${grandTotal}áƒš</span>
</div>
`;
breakdownElement.innerHTML = breakdownHTML;
} else {
breakdownElement.innerHTML = '<p style="color: #999;">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ—áƒáƒ®áƒ˜ áƒ“áƒ áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¤áƒáƒ¡áƒ˜</p>';
}

totalPriceElement.textContent = grandTotal + 'áƒš';
}

function addGuest() {
guestCount++;
const container = document.getElementById('guestsContainer');

const card = document.createElement('div');
card.className = 'card';
card.setAttribute('data-guest-index', guestCount);

card.innerHTML = `
<div class="card-header">
<h4>áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜ #${guestCount}</h4>
<button type="button" class="btn btn-danger remove-btn" onclick="removeGuest(${guestCount})">âŒ áƒ¬áƒáƒ¨áƒšáƒ</button>
</div>

<div class="row">
<div class="form-group">
<label for="guestName${guestCount}">áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ“áƒ áƒ’áƒ•áƒáƒ áƒ˜ *</label>
<input type="text" id="guestName${guestCount}" name="guestName${guestCount}" placeholder="áƒ›áƒáƒ’: áƒœáƒ˜áƒœáƒ áƒ‘áƒ”áƒ áƒ˜áƒ«áƒ”">
<span class="error-message" id="guestName${guestCount}Error">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</span>
</div>

<div class="form-group">
<label for="guestIdNumber${guestCount}">áƒáƒ˜áƒ áƒáƒ“áƒ˜ áƒœáƒáƒ›áƒ”áƒ áƒ˜ *</label>
<input type="text" id="guestIdNumber${guestCount}" name="guestIdNumber${guestCount}" placeholder="áƒ›áƒáƒ’: 01001012345">
<span class="error-message" id="guestIdNumber${guestCount}Error">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒáƒ˜áƒ áƒáƒ“áƒ˜ áƒœáƒáƒ›áƒ”áƒ áƒ˜</span>
</div>
</div>

<div class="row">
<div class="form-group">
<label for="guestCountry${guestCount}">áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ *</label>
<select id="guestCountry${guestCount}" name="guestCountry${guestCount}">
<option value="">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ</option>
<option value="georgia">áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ</option>
<option value="russia">áƒ áƒ£áƒ¡áƒ”áƒ—áƒ˜</option>
<option value="turkey">áƒ—áƒ£áƒ áƒ¥áƒ”áƒ—áƒ˜</option>
<option value="armenia">áƒ¡áƒáƒ›áƒ®áƒ”áƒ—áƒ˜</option>
<option value="azerbaijan">áƒáƒ–áƒ”áƒ áƒ‘áƒáƒ˜áƒ¯áƒáƒœáƒ˜</option>
<option value="ukraine">áƒ£áƒ™áƒ áƒáƒ˜áƒœáƒ</option>
<option value="usa">áƒáƒ¨áƒ¨</option>
<option value="uk">áƒ“áƒ˜áƒ“áƒ˜ áƒ‘áƒ áƒ˜áƒ¢áƒáƒœáƒ”áƒ—áƒ˜</option>
<option value="germany">áƒ’áƒ”áƒ áƒ›áƒáƒœáƒ˜áƒ</option>
<option value="france">áƒ¡áƒáƒ¤áƒ áƒáƒœáƒ’áƒ”áƒ—áƒ˜</option>
<option value="israel">áƒ˜áƒ¡áƒ áƒáƒ”áƒšáƒ˜</option>
<option value="china">áƒ©áƒ˜áƒœáƒ”áƒ—áƒ˜</option>
<option value="india">áƒ˜áƒœáƒ“áƒáƒ”áƒ—áƒ˜</option>
<option value="other">áƒ¡áƒ®áƒ•áƒ</option>
</select>
<span class="error-message" id="guestCountry${guestCount}Error">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒáƒ˜áƒ áƒ©áƒ˜áƒáƒ— áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ</span>
</div>

<div class="form-group">
<label for="guestPhone${guestCount}">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜ (áƒáƒ áƒáƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜)</label>
<input type="tel" id="guestPhone${guestCount}" name="guestPhone${guestCount}" placeholder="+995 555 123 456">
</div>
</div>
`;

container.appendChild(card);

if (guestCount > 1) {
const firstBtn = document.querySelector('[data-guest-index="1"] .remove-btn');
if (firstBtn) firstBtn.style.display = 'inline-block';
}
}

function removeGuest(index) {
const card = document.querySelector(`[data-guest-index="${index}"]`);
if (card) {
card.remove();

const allCards = document.querySelectorAll('#guestsContainer .card');
guestCount = allCards.length;

allCards.forEach((c, i) => {
const newIndex = i + 1;
c.setAttribute('data-guest-index', newIndex);
c.querySelector('h4').textContent = `áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜ #${newIndex}`;

const removeBtn = c.querySelector('.remove-btn');
if (removeBtn) {
removeBtn.setAttribute('onclick', `removeGuest(${newIndex})`);
if (guestCount === 1) {
removeBtn.style.display = 'none';
}
}
});
}
}

function addRoom() {
roomCount++;
const container = document.getElementById('roomsContainer');

const card = document.createElement('div');
card.className = 'card';
card.setAttribute('data-room-index', roomCount);

card.innerHTML = `
<div class="card-header">
<h4>áƒáƒ—áƒáƒ®áƒ˜ #${roomCount}</h4>
<button type="button" class="btn btn-danger remove-btn" onclick="removeRoom(${roomCount})">âŒ áƒ¬áƒáƒ¨áƒšáƒ</button>
</div>

<div class="row">
<div class="form-group">
<label for="roomType${roomCount}">áƒáƒ—áƒáƒ®áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜ *</label>
<select id="roomType${roomCount}" name="roomType${roomCount}">
<option value="">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ—áƒáƒ®áƒ˜</option>
<option value="single">Single - áƒ”áƒ áƒ—áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜</option>
<option value="double">Double - áƒáƒ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜ (áƒ”áƒ áƒ—áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜)</option>
<option value="twin">Twin - áƒáƒ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜ (áƒáƒ áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜)</option>
<option value="triple">Triple - áƒ¡áƒáƒ›áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜</option>
<option value="lux">LUX - áƒšáƒ£áƒ¥áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜</option>
<option value="extra_bed">Extra Bed - áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜</option>
</select>
<span class="error-message" id="roomType${roomCount}Error">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ—áƒáƒ®áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜</span>
</div>

<div class="form-group">
<label for="roomPrice${roomCount}">áƒ¤áƒáƒ¡áƒ˜ (áƒš/áƒ¦áƒáƒ›áƒ”) *</label>
<input type="number" id="roomPrice${roomCount}" name="roomPrice${roomCount}" min="0" step="0.01" placeholder="áƒ›áƒáƒ’: 150">
<span class="error-message" id="roomPrice${roomCount}Error">áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¤áƒáƒ¡áƒ˜</span>
</div>
</div>

<div class="form-group">
<label for="roomNotes${roomCount}">áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ (áƒáƒ áƒáƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜)</label>
<input type="text" id="roomNotes${roomCount}" name="roomNotes${roomCount}" placeholder="áƒ›áƒáƒ’: áƒ–áƒ¦áƒ•áƒ˜áƒ¡ áƒ®áƒ”áƒ“áƒ˜áƒ—">
</div>
`;

container.appendChild(card);
addRoomEventListeners(roomCount);

if (roomCount > 1) {
const firstBtn = document.querySelector('[data-room-index="1"] .remove-btn');
if (firstBtn) firstBtn.style.display = 'inline-block';
}
}

function removeRoom(index) {
const card = document.querySelector(`[data-room-index="${index}"]`);
if (card) {
card.remove();

const allCards = document.querySelectorAll('#roomsContainer .card');
roomCount = allCards.length;

allCards.forEach((c, i) => {
const newIndex = i + 1;
c.setAttribute('data-room-index', newIndex);
c.querySelector('h4').textContent = `áƒáƒ—áƒáƒ®áƒ˜ #${newIndex}`;

const removeBtn = c.querySelector('.remove-btn');
if (removeBtn) {
removeBtn.setAttribute('onclick', `removeRoom(${newIndex})`);
if (roomCount === 1) {
removeBtn.style.display = 'none';
}
}
});

calculatePrice();
}
}

function handleFormSubmit(e) {
e.preventDefault();

if (validateForm()) {
saveBooking();
}
}

function validateForm() {
let isValid = true;

// Validate client
const clientName = document.getElementById('clientName');
if (clientName.value.trim().length < 2) {
showError('clientName');
isValid = false;
} else {
hideError('clientName');
}

const clientEmail = document.getElementById('clientEmail');
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(clientEmail.value)) {
showError('clientEmail');
isValid = false;
} else {
hideError('clientEmail');
}

const clientPhone = document.getElementById('clientPhone');
if (clientPhone.value.trim().length < 9) {
showError('clientPhone');
isValid = false;
} else {
hideError('clientPhone');
}

// Validate at least one guest
let hasGuest = false;
for (let i = 1; i <= guestCount; i++) {
const card = document.querySelector(`[data-guest-index="${i}"]`);
if (!card) continue;

const guestName = document.getElementById(`guestName${i}`);
const guestIdNumber = document.getElementById(`guestIdNumber${i}`);
const guestCountry = document.getElementById(`guestCountry${i}`);

if (guestName && guestName.value.trim()) {
hasGuest = true;

if (guestName.value.trim().length < 2) {
showError(`guestName${i}`);
isValid = false;
} else {
hideError(`guestName${i}`);
}

if (!guestIdNumber.value.trim()) {
showError(`guestIdNumber${i}`);
isValid = false;
} else {
hideError(`guestIdNumber${i}`);
}

if (!guestCountry.value) {
showError(`guestCountry${i}`);
isValid = false;
} else {
hideError(`guestCountry${i}`);
}
}
}

if (!hasGuest) {
showError('guestName1');
isValid = false;
}

// Validate dates
const checkIn = document.getElementById('checkIn');
const checkOut = document.getElementById('checkOut');

if (!checkIn.value) {
showError('checkIn');
isValid = false;
} else {
hideError('checkIn');
}

if (!checkOut.value) {
showError('checkOut');
isValid = false;
} else if (new Date(checkOut.value) <= new Date(checkIn.value)) {
showError('checkOut');
isValid = false;
} else {
hideError('checkOut');
}

// Validate at least one room
let hasRoom = false;
for (let i = 1; i <= roomCount; i++) {
const card = document.querySelector(`[data-room-index="${i}"]`);
if (!card) continue;

const roomType = document.getElementById(`roomType${i}`);
const roomPrice = document.getElementById(`roomPrice${i}`);

if (roomType && roomType.value) {
hasRoom = true;
hideError(`roomType${i}`);

if (!roomPrice || !roomPrice.value || parseFloat(roomPrice.value) <= 0) {
showError(`roomPrice${i}`);
isValid = false;
} else {
hideError(`roomPrice${i}`);
}
}
}

if (!hasRoom) {
showError('roomType1');
isValid = false;
}

return isValid;
}

function showError(fieldId) {
const field = document.getElementById(fieldId);
const error = document.getElementById(fieldId + 'Error');
if (field) field.classList.add('error');
if (error) error.classList.add('show');
}

function hideError(fieldId) {
const field = document.getElementById(fieldId);
const error = document.getElementById(fieldId + 'Error');
if (field) field.classList.remove('error');
if (error) error.classList.remove('show');
}

async function saveBooking() {
// Collect client data
const client = {
type: document.getElementById('clientType').value,
name: document.getElementById('clientName').value,
idCode: document.getElementById('clientIdCode').value,
email: document.getElementById('clientEmail').value,
phone: document.getElementById('clientPhone').value
};

// Collect guests data
let guests = [];
for (let i = 1; i <= guestCount; i++) {
const card = document.querySelector(`[data-guest-index="${i}"]`);
if (!card) continue;

const name = document.getElementById(`guestName${i}`);
const idNumber = document.getElementById(`guestIdNumber${i}`);
const country = document.getElementById(`guestCountry${i}`);
const phone = document.getElementById(`guestPhone${i}`);

if (name && name.value.trim()) {
guests.push({
name: name.value,
idNumber: idNumber ? idNumber.value : '',
country: country ? country.value : '',
phone: phone ? phone.value : ''
});
}
}

// Collect rooms data
let rooms = [];
for (let i = 1; i <= roomCount; i++) {
const card = document.querySelector(`[data-room-index="${i}"]`);
if (!card) continue;

const roomType = document.getElementById(`roomType${i}`);
const roomPrice = document.getElementById(`roomPrice${i}`);
const roomNotes = document.getElementById(`roomNotes${i}`);

if (roomType && roomType.value && roomPrice && roomPrice.value) {
rooms.push({
type: roomType.value,
typeName: roomType.options[roomType.selectedIndex].text,
price: parseFloat(roomPrice.value),
notes: roomNotes ? roomNotes.value : ''
});
}
}

// Collect services
let services = [];
document.querySelectorAll('input[name="services"]:checked').forEach(cb => {
services.push(cb.value);
});

const totalPrice = document.getElementById('totalPrice').textContent.replace('áƒš', '');

const bookingData = {
client: client,
guests: JSON.stringify(guests),
rooms: JSON.stringify(rooms),
checkIn: document.getElementById('checkIn').value,
checkOut: document.getElementById('checkOut').value,
services: services,
totalPrice: parseFloat(totalPrice),
// For backwards compatibility
fullName: client.name,
email: client.email,
phone: client.phone,
roomType: rooms.length > 0 ? rooms[0].type : ''
};

try {
const response = await fetch('api.php?action=create', { credentials: 'include',
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(bookingData)
});

const result = await response.json();

if (result.success) {
showSuccessMessage('âœ“ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒ! áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜ #' + result.invoiceNumber);

setTimeout(() => {
document.getElementById('bookingForm').reset();
document.getElementById('totalPrice').textContent = '0áƒš';
document.getElementById('priceBreakdown').innerHTML = '<p style="color: #999;">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜</p>';

// Reset to one room and one guest
while (roomCount > 1) removeRoom(roomCount);
while (guestCount > 1) removeGuest(guestCount);

// Switch to bookings list
const bookingsTab = document.querySelectorAll('.tab-btn')[1];
switchTab('bookings-list', bookingsTab);
}, 2000);
} else {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + result.message);
}
} catch (error) {
console.error('Error:', error);
alert('áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ˜áƒ¡áƒáƒ¡ áƒ›áƒáƒ®áƒ“áƒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ');
}
}

function showSuccessMessage(message) {
const msg = document.getElementById('successMessage');
msg.textContent = message;
msg.classList.add('show');
setTimeout(() => msg.classList.remove('show'), 4000);
}

// Tab switching
function switchTab(tabName, button) {
document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

document.getElementById(tabName).classList.add('active');
button.classList.add('active');

if (tabName === 'bookings-list') {
loadBookings();
}
}

// Load bookings
async function loadBookings() {
const loadingMessage = document.getElementById('loadingMessage');
const table = document.getElementById('bookingsTable');
const noDataMessage = document.getElementById('noDataMessage');

loadingMessage.style.display = 'block';
table.style.display = 'none';
noDataMessage.style.display = 'none';

try {
const response = await fetch('api.php?action=bookings', { credentials: 'include' });

if (response.status === 401) {
alert('áƒ¡áƒ”áƒ¡áƒ˜áƒ áƒáƒ›áƒáƒ˜áƒ¬áƒ£áƒ áƒ. áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ®áƒ”áƒšáƒáƒ®áƒšáƒ áƒ¨áƒ”áƒ“áƒ˜áƒ—.');
if (window.top) window.top.location.reload();
return;
}

const data = await response.json();

loadingMessage.style.display = 'none';

if (data.success && data.bookings.length > 0) {
displayBookings(data.bookings);
table.style.display = 'table';
} else {
noDataMessage.style.display = 'block';
}
} catch (error) {
console.error('Error:', error);
loadingMessage.textContent = 'áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ';
}
}

function displayBookings(bookings) {
const tbody = document.getElementById('bookingsTableBody');
tbody.innerHTML = '';

// Apply filters
const emailFilter = document.getElementById('searchEmail').value.toLowerCase();
const dateFilter = document.getElementById('filterDate').value;
const statusFilter = document.getElementById('filterStatus').value;

const filteredBookings = bookings.filter(booking => {
const emailMatch = !emailFilter ||
(booking.email && booking.email.toLowerCase().includes(emailFilter)) ||
(booking.client_email && booking.client_email.toLowerCase().includes(emailFilter));
const dateMatch = !dateFilter || booking.check_in === dateFilter;
const statusMatch = !statusFilter || booking.status === statusFilter;
return emailMatch && dateMatch && statusMatch;
});

filteredBookings.forEach((booking, index) => {
const row = document.createElement('tr');

const checkInDate = new Date(booking.check_in).toLocaleDateString('ka-GE');
const checkOutDate = new Date(booking.check_out).toLocaleDateString('ka-GE');
const clientName = booking.client_name || booking.full_name || '-';
const clientEmail = booking.client_email || booking.email || '-';

// Store booking data in a global object with unique key
const bookingKey = `booking_${booking.id}`;
window[bookingKey] = booking;

row.innerHTML = `
<td><strong>${booking.invoice_number}</strong></td>
<td>${clientName}</td>
<td>${clientEmail}</td>
<td>${checkInDate}</td>
<td>${checkOutDate}</td>
<td><strong>${booking.total_price}áƒš</strong></td>
<td><span class="status ${booking.status}">${getStatusText(booking.status)}</span></td>
<td class="actions">
<button class="btn btn-info action-btn" onclick="viewBooking('${bookingKey}')">ğŸ‘ï¸ áƒœáƒáƒ®áƒ•áƒ</button>
<button class="btn btn-warning action-btn" onclick="editBooking('${bookingKey}')">âœï¸ áƒ¨áƒ”áƒªáƒ•áƒšáƒ</button>
<button class="btn btn-danger action-btn" onclick="deleteBooking(${booking.id})">ğŸ—‘ï¸ áƒ¬áƒáƒ¨áƒšáƒ</button>
<button class="btn btn-primary action-btn" onclick="printInvoice('${bookingKey}')">ğŸ–¨ï¸ áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜</button>
</td>
`;

tbody.appendChild(row);
});
}

function getStatusText(status) {
const statusMap = {
'confirmed': 'áƒ“áƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜',
'checked_in': 'áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜',
'checked_out': 'áƒ’áƒáƒ¡áƒ£áƒšáƒ˜',
'cancelled': 'áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ£áƒšáƒ˜'
};
return statusMap[status] || status;
}

function getCountryName(code) {
const countries = {
'georgia': 'áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ',
'russia': 'áƒ áƒ£áƒ¡áƒ”áƒ—áƒ˜',
'turkey': 'áƒ—áƒ£áƒ áƒ¥áƒ”áƒ—áƒ˜',
'armenia': 'áƒ¡áƒáƒ›áƒ®áƒ”áƒ—áƒ˜',
'azerbaijan': 'áƒáƒ–áƒ”áƒ áƒ‘áƒáƒ˜áƒ¯áƒáƒœáƒ˜',
'ukraine': 'áƒ£áƒ™áƒ áƒáƒ˜áƒœáƒ',
'usa': 'áƒáƒ¨áƒ¨',
'uk': 'áƒ“áƒ˜áƒ“áƒ˜ áƒ‘áƒ áƒ˜áƒ¢áƒáƒœáƒ”áƒ—áƒ˜',
'germany': 'áƒ’áƒ”áƒ áƒ›áƒáƒœáƒ˜áƒ',
'france': 'áƒ¡áƒáƒ¤áƒ áƒáƒœáƒ’áƒ”áƒ—áƒ˜',
'israel': 'áƒ˜áƒ¡áƒ áƒáƒ”áƒšáƒ˜',
'china': 'áƒ©áƒ˜áƒœáƒ”áƒ—áƒ˜',
'india': 'áƒ˜áƒœáƒ“áƒáƒ”áƒ—áƒ˜',
'other': 'áƒ¡áƒ®áƒ•áƒ'
};
return countries[code] || code;
}

function viewBooking(bookingKey) {
const booking = window[bookingKey];
if (!booking) {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ');
return;
}

const modal = document.getElementById('viewModal');
const content = document.getElementById('viewModalContent');

let guests = [];
try {
guests = booking.guests ? JSON.parse(booking.guests) : [];
} catch(e) {}

let rooms = [];
try {
rooms = booking.rooms ? JSON.parse(booking.rooms) : [];
} catch(e) {}

let services = [];
try {
services = booking.services ? JSON.parse(booking.services) : [];
} catch(e) {}

let guestsHTML = '';
guests.forEach((guest, index) => {
guestsHTML += `
<div class="info-row">
<div class="info-label">áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜ #${index + 1}:</div>
<div class="info-value">
${guest.name} (${guest.idNumber})<br>
${getCountryName(guest.country)}
${guest.phone ? ', ' + guest.phone : ''}
</div>
</div>
`;
});

let roomsHTML = '';
rooms.forEach((room, index) => {
roomsHTML += `
<div class="info-row">
<div class="info-label">áƒáƒ—áƒáƒ®áƒ˜ #${index + 1}:</div>
<div class="info-value">
${room.typeName} - ${room.price}áƒš/áƒ¦áƒáƒ›áƒ”
${room.notes ? '<br>' + room.notes : ''}
</div>
</div>
`;
});

content.innerHTML = `
<div class="info-grid">
<h3 style="color: #667eea; margin-bottom: 10px;">áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</h3>
<div class="info-row">
<div class="info-label">áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜:</div>
<div class="info-value"><strong>${booking.invoice_number}</strong></div>
</div>
<div class="info-row">
<div class="info-label">áƒ¢áƒ˜áƒáƒ˜:</div>
<div class="info-value">${booking.client_type || 'áƒ¤áƒ˜áƒ–áƒ˜áƒ™áƒ£áƒ áƒ˜ áƒáƒ˜áƒ áƒ˜'}</div>
</div>
<div class="info-row">
<div class="info-label">áƒ¡áƒáƒ®áƒ”áƒšáƒ˜/áƒ“áƒáƒ¡áƒáƒ®áƒ”áƒšáƒ”áƒ‘áƒ:</div>
<div class="info-value">${booking.client_name || booking.full_name}</div>
</div>
<div class="info-row">
<div class="info-label">áƒ¡áƒáƒ˜áƒ“áƒ”áƒœáƒ¢áƒ˜áƒ¤áƒ˜áƒ™áƒáƒªáƒ˜áƒ áƒ™áƒáƒ“áƒ˜:</div>
<div class="info-value">${booking.client_id_code || 'â€”'}</div>
</div>
<div class="info-row">
<div class="info-label">áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ:</div>
<div class="info-value">${booking.client_email || booking.email}</div>
</div>
<div class="info-row">
<div class="info-label">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜:</div>
<div class="info-value">${booking.client_phone || booking.phone}</div>
</div>

<h3 style="color: #667eea; margin: 20px 0 10px;">áƒ¡áƒ¢áƒ£áƒ›áƒ áƒ”áƒ‘áƒ˜</h3>
${guestsHTML || '<p>áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡</p>'}

<h3 style="color: #667eea; margin: 20px 0 10px;">áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜</h3>
<div class="info-row">
<div class="info-label">áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ:</div>
<div class="info-value">${new Date(booking.check_in).toLocaleDateString('ka-GE')}</div>
</div>
<div class="info-row">
<div class="info-label">áƒ’áƒáƒ¡áƒ•áƒšáƒ:</div>
<div class="info-value">${new Date(booking.check_out).toLocaleDateString('ka-GE')}</div>
</div>
<div class="info-row">
<div class="info-label">áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜:</div>
<div class="info-value"><span class="status ${booking.status}">${getStatusText(booking.status)}</span></div>
</div>

<h3 style="color: #667eea; margin: 20px 0 10px;">áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜</h3>
${roomsHTML || '<p>áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡</p>'}

${services.length > 0 ? `
<h3 style="color: #667eea; margin: 20px 0 10px;">áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ”áƒ‘áƒ˜</h3>
<div class="info-row">
<div class="info-value">${services.join(', ')}</div>
</div>
` : ''}

<div class="info-row" style="background: #667eea; color: white; margin-top: 20px;">
<div class="info-label" style="color: white;">áƒ¡áƒ£áƒš áƒ—áƒáƒœáƒ®áƒ:</div>
<div class="info-value" style="font-size: 24px; font-weight: bold;">${booking.total_price}áƒš</div>
</div>
</div>
`;

modal.classList.add('show');
}

function closeViewModal() {
document.getElementById('viewModal').classList.remove('show');
}

function editBooking(bookingKey) {
const booking = window[bookingKey];
if (!booking) {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ');
return;
}

const modal = document.getElementById('editModal');
const content = document.getElementById('editModalContent');

content.innerHTML = `
<form id="editForm" onsubmit="saveEditedBooking(event, ${booking.id})">
<div class="form-group">
<label>áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜</label>
<select id="editStatus" required>
<option value="confirmed" ${booking.status === 'confirmed' ? 'selected' : ''}>áƒ“áƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
<option value="checked_in" ${booking.status === 'checked_in' ? 'selected' : ''}>áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
<option value="checked_out" ${booking.status === 'checked_out' ? 'selected' : ''}>áƒ’áƒáƒ¡áƒ£áƒšáƒ˜</option>
<option value="cancelled" ${booking.status === 'cancelled' ? 'selected' : ''}>áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
</select>
</div>
<div class="row">
<div class="form-group">
<label>áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ</label>
<input type="date" id="editCheckIn" value="${booking.check_in}" required>
</div>
<div class="form-group">
<label>áƒ’áƒáƒ¡áƒ•áƒšáƒ</label>
<input type="date" id="editCheckOut" value="${booking.check_out}" required>
</div>
</div>
<div class="form-group">
<label>áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ</label>
<textarea id="editNotes" rows="3">${booking.notes || ''}</textarea>
</div>
<button type="submit" class="btn btn-primary btn-full">ğŸ’¾ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
</form>
`;

modal.classList.add('show');
}

function closeEditModal() {
document.getElementById('editModal').classList.remove('show');
}

async function saveEditedBooking(event, bookingId) {
event.preventDefault();

const status = document.getElementById('editStatus').value;
const checkIn = document.getElementById('editCheckIn').value;
const checkOut = document.getElementById('editCheckOut').value;
const notes = document.getElementById('editNotes').value;

try {
const response = await fetch(`api.php?action=update&id=${bookingId}&_method=PUT`, { credentials: 'include',
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify({
status: status,
checkIn: checkIn,
checkOut: checkOut,
notes: notes
})
});

const result = await response.json();

if (result.success) {
showSuccessMessage('âœ“ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ');
closeEditModal();
loadBookings();
} else {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + result.message);
}
} catch (error) {
console.error('Error:', error);
alert('áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡ áƒ›áƒáƒ®áƒ“áƒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ');
}
}

async function deleteBooking(id) {
if (!confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ áƒ— áƒ áƒáƒ› áƒ’áƒ¡áƒ£áƒ áƒ— áƒáƒ› áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')) {
return;
}

try {
const response = await fetch(`api.php?action=delete&id=${id}&_method=DELETE`, { credentials: 'include',
method: 'POST'
});

const result = await response.json();

if (result.success) {
showSuccessMessage('âœ“ áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ');
loadBookings();
} else {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + result.message);
}
} catch (error) {
console.error('Error:', error);
alert('áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡áƒáƒ¡ áƒ›áƒáƒ®áƒ“áƒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ');
}
}

function printInvoice(bookingKey) {
const booking = window[bookingKey];
if (!booking) {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ');
return;
}

window.currentBookingForInvoice = booking;
showDateRangeModal();
}

function showDateRangeModal() {
const booking = window.currentBookingForInvoice;
const checkIn = booking.check_in;
const checkOut = booking.check_out;

const inDate = new Date(checkIn);
const outDate = new Date(checkOut);
const totalNights = Math.ceil((outDate - inDate) / (1000 * 60 * 60 * 24));

// áƒ—áƒ•áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ
const spansTwoMonths = inDate.getMonth() !== outDate.getMonth() || inDate.getFullYear() !== outDate.getFullYear();

const modal = document.getElementById('editModal');
const content = document.getElementById('editModalContent');

content.innerHTML = `
<div style="padding: 20px;">
<h3 style="color: #667eea; margin-bottom: 20px;">ğŸ–¨ï¸ áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜</h3>

<div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
<div style="font-size: 13px; color: #666; margin-bottom: 8px;">áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¯áƒáƒ•áƒ¨áƒáƒœáƒ˜:</div>
<div style="font-weight: 600;">${checkIn} â†’ ${checkOut} (${totalNights} áƒ¦áƒáƒ›áƒ”)</div>
</div>

${spansTwoMonths ? `
<div style="background: #fff3cd; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 12px; color: #856404;">
âš ï¸ áƒ”áƒ¡ áƒ¯áƒáƒ•áƒ¨áƒáƒœáƒ˜ áƒáƒ  áƒ—áƒ•áƒ”áƒ¡ áƒ›áƒáƒ˜áƒªáƒáƒ•áƒ¡. áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜ áƒ¨áƒ”áƒªáƒ•áƒáƒšáƒáƒ— áƒœáƒáƒ¬áƒ˜áƒšáƒáƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.
</div>
` : ''}

<div style="display: flex; gap: 15px; margin-bottom: 20px;">
<div style="flex: 1;">
<label style="display:block; font-size:13px; font-weight:600; margin-bottom:5px; color:#555;">áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ:</label>
<input type="date" id="invoiceFrom" value="${checkIn}" min="${checkIn}" max="${checkOut}"
style="width:100%; padding:10px; border:2px solid #e0e0e0; border-radius:6px; font-size:14px;"
onchange="updateInvoicePreview()">
</div>
<div style="flex: 1;">
<label style="display:block; font-size:13px; font-weight:600; margin-bottom:5px; color:#555;">áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ:</label>
<input type="date" id="invoiceTo" value="${checkOut}" min="${checkIn}" max="${checkOut}"
style="width:100%; padding:10px; border:2px solid #e0e0e0; border-radius:6px; font-size:14px;"
onchange="updateInvoicePreview()">
</div>
</div>

<div id="invoicePreview" style="background: #e8f5e9; border-radius: 8px; padding: 12px; margin-bottom: 20px; text-align: center;">
<span style="font-size: 20px; font-weight: 700; color: #2e7d32;">${totalNights}</span>
<span style="color: #555; font-size: 13px;"> áƒ¦áƒáƒ›áƒ” áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ¨áƒ˜</span>
</div>

<div style="margin-bottom: 15px;">
<label style="display:block; font-size:13px; font-weight:600; margin-bottom:5px; color:#555;">áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜:</label>
<input type="text" id="invoiceNumberOverride" value="${booking.invoice_number}"
style="width:100%; padding:10px; border:2px solid #e0e0e0; border-radius:6px; font-size:14px;"
placeholder="áƒ›áƒáƒ’: INV-001/1">
<div style="font-size:11px; color:#999; margin-top:3px;">áƒœáƒáƒ¬áƒ˜áƒšáƒáƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— /1, /2 áƒ“áƒáƒ£áƒ›áƒáƒ¢áƒáƒ—</div>
</div>

<h4 style="color: #667eea; margin-bottom: 15px;">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ”áƒœáƒ:</h4>
<div style="display: flex; gap: 15px; justify-content: center;">
<button class="btn btn-primary" style="padding: 15px 35px; font-size: 16px;" onclick="generateInvoiceWithRange('ka')">
ğŸ‡¬ğŸ‡ª áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜
</button>
<button class="btn btn-info" style="padding: 15px 35px; font-size: 16px;" onclick="generateInvoiceWithRange('en')">
ğŸ‡¬ğŸ‡§ English
</button>
</div>
</div>
`;

modal.classList.add('show');
}

function updateInvoicePreview() {
const from = new Date(document.getElementById('invoiceFrom').value);
const to = new Date(document.getElementById('invoiceTo').value);
const nights = Math.ceil((to - from) / (1000 * 60 * 60 * 24));
const preview = document.getElementById('invoicePreview');

if (nights <= 0) {
preview.innerHTML = '<span style="color: #e74c3c; font-size: 13px;">âš ï¸ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜</span>';
} else {
preview.innerHTML = `
<span style="font-size: 20px; font-weight: 700; color: #2e7d32;">${nights}</span>
<span style="color: #555; font-size: 13px;"> áƒ¦áƒáƒ›áƒ” áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ¨áƒ˜</span>
`;
}
}

function generateInvoiceWithRange(lang) {
const booking = window.currentBookingForInvoice;
const invoiceFrom = document.getElementById('invoiceFrom').value;
const invoiceTo = document.getElementById('invoiceTo').value;
const invoiceNumber = document.getElementById('invoiceNumberOverride').value || booking.invoice_number;

const fromDate = new Date(invoiceFrom);
const toDate = new Date(invoiceTo);
const nights = Math.ceil((toDate - fromDate) / (1000 * 60 * 60 * 24));

if (nights <= 0) {
alert('áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜');
return;
}

closeEditModal();

// Override booking data for invoice
const invoiceBooking = {...booking};
invoiceBooking.check_in = invoiceFrom;
invoiceBooking.check_out = invoiceTo;
invoiceBooking.invoice_number = invoiceNumber;
invoiceBooking._customNights = nights;

// áƒ áƒ”áƒ™áƒáƒšáƒ™áƒ£áƒšáƒáƒªáƒ˜áƒ: total_price = áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜áƒ¡ áƒ¤áƒáƒ¡áƒ˜ Ã— áƒ¦áƒáƒ›áƒ”áƒ”áƒ‘áƒ˜
let rooms = [];
try { rooms = booking.rooms ? JSON.parse(booking.rooms) : []; } catch(e) {}
let roomsTotal = 0;
rooms.forEach(r => { roomsTotal += (r.price || 0) * nights; });
invoiceBooking.total_price = roomsTotal;

window.currentBookingForInvoice = invoiceBooking;
generateInvoice(lang);
}

function generateInvoice(lang) {
const booking = window.currentBookingForInvoice;
closeEditModal();

if (!booking) {
alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ');
return;
}

let guests = [];
try {
guests = booking.guests ? JSON.parse(booking.guests) : [];
} catch(e) {}

let rooms = [];
try {
rooms = booking.rooms ? JSON.parse(booking.rooms) : [];
} catch(e) {}

const checkIn = new Date(booking.check_in);
const checkOut = new Date(booking.check_out);
const nights = booking._customNights || Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));

const t = lang === 'ka' ? {
title: 'HOTEL 725',
invoice: 'áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜',
date: 'áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜',
companyName: 'áƒ¨áƒáƒ¡ NASCAR',
idCode: 'áƒ¡áƒáƒ˜áƒ“áƒ”áƒœáƒ¢áƒ˜áƒ¤áƒ˜áƒ™áƒáƒªáƒ˜áƒ áƒ™áƒáƒ“áƒ˜',
address: 'áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜',
phone: 'áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜',
mobile: 'áƒ›áƒáƒ‘',
bankDetails: 'áƒ¡áƒáƒ‘áƒáƒœáƒ™áƒ áƒ áƒ”áƒ™áƒ•áƒ˜áƒ–áƒ˜áƒ¢áƒ”áƒ‘áƒ˜',
recipientBank: 'áƒ›áƒ˜áƒ›áƒ¦áƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒáƒœáƒ™áƒ˜',
bankCode: 'áƒ‘áƒáƒœáƒ™áƒ˜áƒ¡ áƒ™áƒáƒ“áƒ˜',
accountNumber: 'áƒ/áƒ',
clientInfo: 'áƒ¨áƒ”áƒ›áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ',
type: 'áƒ¢áƒ˜áƒáƒ˜',
name: 'áƒ¡áƒáƒ®áƒ”áƒšáƒ˜/áƒ“áƒáƒ¡áƒáƒ®áƒ”áƒšáƒ”áƒ‘áƒ',
email: 'áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ',
clientPhone: 'áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜',
guests: 'áƒ¡áƒ¢áƒ£áƒ›áƒ áƒ”áƒ‘áƒ˜',
bookingDetails: 'áƒ“áƒáƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜',
checkIn: 'áƒ“áƒáƒ‘áƒ˜áƒœáƒáƒ•áƒ”áƒ‘áƒ',
checkOut: 'áƒ’áƒáƒ¡áƒ•áƒšáƒ',
nights: 'áƒ¦áƒáƒ›áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ',
nightsText: 'áƒ¦áƒáƒ›áƒ”',
prices: 'áƒ¤áƒáƒ¡áƒ”áƒ‘áƒ˜',
service: 'áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜',
pricePerNight: 'áƒ¤áƒáƒ¡áƒ˜/áƒ¦áƒáƒ›áƒ”',
quantity: 'áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ',
total: 'áƒ¡áƒ£áƒš',
totalAmount: 'áƒ¡áƒ£áƒš áƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒ“áƒ”áƒšáƒ˜',
currency: 'áƒš',
thankYou: 'áƒ’áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ— áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¡ áƒáƒ áƒ©áƒ”áƒ•áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡!',
noInfo: 'áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡',
room: 'áƒáƒ—áƒáƒ®áƒ˜',
addressText: 'áƒ¥. áƒ‘áƒáƒ—áƒ£áƒ›áƒ˜, áƒ¤áƒ áƒ˜áƒ“áƒ˜áƒœ áƒ®áƒáƒšáƒ•áƒáƒ¨áƒ˜áƒ¡ áƒ’áƒáƒ›áƒ–áƒ˜áƒ áƒ˜ 45áƒ/42',
bankName: 'áƒ¡áƒ¡ "áƒáƒ áƒáƒ™áƒ áƒ”áƒ“áƒ˜áƒ¢ áƒ‘áƒáƒœáƒ™áƒ˜"'
} : {
title: 'HOTEL 725',
invoice: 'Invoice',
date: 'Date',
companyName: 'LLC NASCAR',
idCode: 'ID Code',
address: 'Address',
phone: 'Phone',
mobile: 'Mobile',
bankDetails: 'Bank Details',
recipientBank: 'Recipient Bank',
bankCode: 'Bank Code',
accountNumber: 'Account',
clientInfo: 'Client Information',
type: 'Type',
name: 'Name',
email: 'Email',
clientPhone: 'Phone',
guests: 'Guests',
bookingDetails: 'Booking Details',
checkIn: 'Check-in',
checkOut: 'Check-out',
nights: 'Number of Nights',
nightsText: 'night(s)',
prices: 'Prices',
service: 'Service',
pricePerNight: 'Price/Night',
quantity: 'Quantity',
total: 'Total',
totalAmount: 'Total Amount',
currency: 'GEL',
thankYou: 'Thank you for choosing our hotel!',
noInfo: 'No information',
room: 'Room',
addressText: 'Batumi, Fridon Khalvashi Ave. 45a/42',
bankName: 'JSC "ProCredit Bank"'
};

let guestsHTML = guests.map((g, i) =>
`${i + 1}. ${g.name} (${g.idNumber}) - ${getCountryNameLang(g.country, lang)}`
).join('<br>');

let roomsHTML = '';
rooms.forEach((room, i) => {
const total = room.price * nights;
roomsHTML += `
<tr>
<td>${t.room} #${i + 1}: ${getRoomTypeNameLang(room.type, lang)}</td>
<td style="text-align: right;">${room.price}${t.currency}</td>
<td style="text-align: right;">${nights}</td>
<td style="text-align: right;"><strong>${total}${t.currency}</strong></td>
</tr>
`;
});

const clientType = lang === 'ka' ? {
'individual': 'áƒ¤áƒ˜áƒ–áƒ˜áƒ™áƒ£áƒ áƒ˜ áƒáƒ˜áƒ áƒ˜',
'agency': 'áƒ¢áƒ£áƒ áƒ˜áƒ¡áƒ¢áƒ£áƒšáƒ˜ áƒ¡áƒáƒáƒ’áƒ”áƒœáƒ¢áƒ',
'company': 'áƒ™áƒáƒ›áƒáƒáƒœáƒ˜áƒ'
}[booking.client_type || 'individual'] : {
'individual': 'Individual',
'agency': 'Travel Agency',
'company': 'Company'
}[booking.client_type || 'individual'];

const invoiceHTML = `
<!DOCTYPE html>
<html lang="${lang}">
<head>
<meta charset="utf-8">
<title>${t.invoice} ${booking.invoice_number} - ${t.title}</title>
<style>
@page {
size: A4;
margin: 10mm;
}
body {
font-family: 'Sylfaen', 'Arial', 'DejaVu Sans', sans-serif;
padding: 0;
margin: 0;
font-size: 11px;
color: #333;
}
.invoice-container {
max-width: 190mm;
margin: 0 auto;
padding: 5px;
background: white;
}
.header {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 3px solid #1a5490;
}
.company-info {
flex: 1;
}
.hotel-name {
font-size: 24px;
font-weight: bold;
color: #1a5490;
margin-bottom: 5px;
letter-spacing: 2px;
}
.company-name {
font-size: 14px;
font-weight: 600;
color: #333;
margin-bottom: 5px;
}
.company-details {
font-size: 11px;
line-height: 1.6;
color: #666;
}
.invoice-info {
text-align: right;
flex: 0 0 auto;
}
.invoice-number {
font-size: 18px;
font-weight: bold;
color: #1a5490;
margin-bottom: 5px;
}
.invoice-date {
font-size: 12px;
color: #666;
}
.section {
margin-bottom: 12px;
page-break-inside: avoid;
}
.section-title {
color: #1a5490;
font-size: 12px;
font-weight: 700;
border-bottom: 2px solid #e0e0e0;
padding-bottom: 5px;
margin-bottom: 8px;
}
table {
width: 100%;
border-collapse: collapse;
margin-top: 5px;
}
th, td {
padding: 6px 8px;
text-align: left;
border-bottom: 1px solid #e0e0e0;
font-size: 10px;
}
th {
background: #f8f9fa;
font-weight: 700;
color: #1a5490;
}
.total-row {
background: #1a5490;
color: white;
font-size: 13px;
font-weight: bold;
}
.info-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 6px;
}
.info-item {
background: #f8f9fa;
padding: 6px 8px;
border-radius: 4px;
border-left: 3px solid #1a5490;
}
.info-label {
font-size: 10px;
color: #666;
margin-bottom: 3px;
font-weight: 600;
}
.info-value {
font-size: 12px;
color: #333;
font-weight: 500;
}
.bank-details {
background: #f0f4f8;
padding: 15px;
border-radius: 8px;
border: 1px solid #d0dae6;
margin-top: 15px;
}
.bank-row {
display: flex;
justify-content: space-between;
padding: 5px 0;
font-size: 11px;
}
.bank-label {
font-weight: 600;
color: #555;
}
.bank-value {
color: #333;
font-weight: 500;
}
.guests-list {
padding: 12px;
background: #f8f9fa;
border-radius: 5px;
line-height: 1.8;
font-size: 11px;
}
.footer {
text-align: center;
margin-top: 40px;
padding-top: 20px;
border-top: 2px solid #e0e0e0;
color: #666;
font-size: 11px;
}
.footer-thank-you {
font-size: 14px;
font-weight: 600;
color: #1a5490;
margin-bottom: 10px;
}
.contact-info {
margin-top: 8px;
font-size: 10px;
}
@media print {
.invoice-container { padding: 0; }
body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
.section { page-break-inside: avoid; }
}
</style>
</head>
<body>
<div class="invoice-container">
<div class="header">
<div class="company-info">
<div class="hotel-name">${t.title}</div>
<div class="company-name">${t.companyName}</div>
<div class="company-details">
${t.idCode}: 445418423<br>
${t.address}: ${t.addressText}<br>
${t.phone}: 0422 228 725 | ${t.mobile}: +995 555 334 725
</div>
</div>
<div class="invoice-info">
<div class="invoice-number">${t.invoice} #${booking.invoice_number}</div>
<div class="invoice-date">${t.date}: ${new Date().toLocaleDateString(lang === 'ka' ? 'ka-GE' : 'en-US')}</div>
</div>
</div>

<div class="section">
<div class="section-title">${t.clientInfo}</div>
<div class="info-grid">
<div class="info-item">
<div class="info-label">${t.type}</div>
<div class="info-value">${clientType}</div>
</div>
<div class="info-item">
<div class="info-label">${t.name}</div>
<div class="info-value">${booking.client_name || booking.full_name}</div>
</div>
<div class="info-item">
<div class="info-label">${t.idCode}</div>
<div class="info-value">${booking.client_id_code || '-'}</div>
</div>
<div class="info-item">
<div class="info-label">${t.email}</div>
<div class="info-value">${booking.client_email || booking.email}</div>
</div>
<div class="info-item">
<div class="info-label">${t.clientPhone}</div>
<div class="info-value">${booking.client_phone || booking.phone}</div>
</div>
</div>
</div>

<div class="section">
<div class="section-title">${t.guests}</div>
<div class="guests-list">${guestsHTML || t.noInfo}</div>
</div>

<div class="section">
<div class="section-title">${t.bookingDetails}</div>
<div class="info-grid">
<div class="info-item">
<div class="info-label">${t.checkIn}</div>
<div class="info-value">${checkIn.toLocaleDateString(lang === 'ka' ? 'ka-GE' : 'en-US')}</div>
</div>
<div class="info-item">
<div class="info-label">${t.checkOut}</div>
<div class="info-value">${checkOut.toLocaleDateString(lang === 'ka' ? 'ka-GE' : 'en-US')}</div>
</div>
<div class="info-item" style="grid-column: span 2;">
<div class="info-label">${t.nights}</div>
<div class="info-value">${nights} ${t.nightsText}</div>
</div>
</div>
</div>

<div class="section">
<div class="section-title">${t.prices}</div>
<table>
<thead>
<tr>
<th>${t.service}</th>
<th style="text-align: right;">${t.pricePerNight}</th>
<th style="text-align: right;">${t.quantity}</th>
<th style="text-align: right;">${t.total}</th>
</tr>
</thead>
<tbody>
${roomsHTML}
<tr class="total-row">
<td colspan="3" style="text-align: right; padding-right: 20px;">${t.totalAmount}:</td>
<td style="text-align: right;"><strong>${booking.total_price}${t.currency}</strong></td>
</tr>
</tbody>
</table>
</div>

<div class="section">
<div class="section-title">${t.bankDetails}</div>
<div class="bank-details">
<div class="bank-row">
<span class="bank-label">${t.recipientBank}:</span>
<span class="bank-value">${t.bankName}</span>
</div>
<div class="bank-row">
<span class="bank-label">${t.bankCode}:</span>
<span class="bank-value">MIBGGE22</span>
</div>
<div class="bank-row">
<span class="bank-label">${t.accountNumber}:</span>
<span class="bank-value">GE37PC0033600100055682</span>
</div>
</div>
</div>

<div class="footer">
<div class="footer-thank-you">${t.thankYou}</div>
<div class="contact-info">
${t.title} â€¢ ${t.addressText}<br>
${t.phone}: 0422 228 725 â€¢ ${t.mobile}: +995 555 334 725<br>
Email: info@hotel725.ge â€¢ Web: www.hotel725.ge
</div>
</div>
</div>
</body>
</html>
`;

const printWindow = window.open('', '_blank');
printWindow.document.write(invoiceHTML);
printWindow.document.close();
setTimeout(() => {
printWindow.print();
}, 250);
}

function getCountryNameLang(code, lang) {
const countries = {
ka: {
'georgia': 'áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ', 'russia': 'áƒ áƒ£áƒ¡áƒ”áƒ—áƒ˜', 'turkey': 'áƒ—áƒ£áƒ áƒ¥áƒ”áƒ—áƒ˜',
'armenia': 'áƒ¡áƒáƒ›áƒ®áƒ”áƒ—áƒ˜', 'azerbaijan': 'áƒáƒ–áƒ”áƒ áƒ‘áƒáƒ˜áƒ¯áƒáƒœáƒ˜', 'ukraine': 'áƒ£áƒ™áƒ áƒáƒ˜áƒœáƒ',
'usa': 'áƒáƒ¨áƒ¨', 'uk': 'áƒ“áƒ˜áƒ“áƒ˜ áƒ‘áƒ áƒ˜áƒ¢áƒáƒœáƒ”áƒ—áƒ˜', 'germany': 'áƒ’áƒ”áƒ áƒ›áƒáƒœáƒ˜áƒ',
'france': 'áƒ¡áƒáƒ¤áƒ áƒáƒœáƒ’áƒ”áƒ—áƒ˜', 'israel': 'áƒ˜áƒ¡áƒ áƒáƒ”áƒšáƒ˜', 'china': 'áƒ©áƒ˜áƒœáƒ”áƒ—áƒ˜',
'india': 'áƒ˜áƒœáƒ“áƒáƒ”áƒ—áƒ˜', 'other': 'áƒ¡áƒ®áƒ•áƒ'
},
en: {
'georgia': 'Georgia', 'russia': 'Russia', 'turkey': 'Turkey',
'armenia': 'Armenia', 'azerbaijan': 'Azerbaijan', 'ukraine': 'Ukraine',
'usa': 'USA', 'uk': 'United Kingdom', 'germany': 'Germany',
'france': 'France', 'israel': 'Israel', 'china': 'China',
'india': 'India', 'other': 'Other'
}
};
return countries[lang][code] || code;
}

function getRoomTypeNameLang(code, lang) {
const rooms = {
ka: {
'single': 'Single - áƒ”áƒ áƒ—áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜',
'double': 'Double - áƒáƒ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜',
'twin': 'Twin - áƒáƒ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜ (áƒáƒ áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜)',
'triple': 'Triple - áƒ¡áƒáƒ›áƒáƒ“áƒ’áƒ˜áƒšáƒ˜áƒáƒœáƒ˜',
'lux': 'LUX - áƒšáƒ£áƒ¥áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜',
'extra_bed': 'Extra Bed - áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ¡áƒáƒ¬áƒáƒšáƒ˜'
},
en: {
'single': 'Single Room',
'double': 'Double Room',
'twin': 'Twin Room (Two Beds)',
'triple': 'Triple Room',
'lux': 'LUX Room',
'extra_bed': 'Extra Bed'
}
};
return rooms[lang][code] || code;
}

function clearFilters() {
document.getElementById('searchEmail').value = '';
document.getElementById('filterDate').value = '';
document.getElementById('filterStatus').value = '';
loadBookings();
}

// === áƒ™áƒšáƒ˜áƒ”áƒœáƒ¢áƒ˜áƒ¡ Autocomplete ===
(function() {
let acTimeout = null;
const nameInput = document.getElementById('clientName');
const codeInput = document.getElementById('clientIdCode');
const dropName = document.getElementById('acDropdownName');
const dropCode = document.getElementById('acDropdownCode');

nameInput.addEventListener('input', function() {
clearTimeout(acTimeout);
const q = this.value.trim();
if (q.length < 2) { dropName.classList.remove('show'); return; }
acTimeout = setTimeout(() => acSearch(q, dropName), 300);
});

codeInput.addEventListener('input', function() {
clearTimeout(acTimeout);
const q = this.value.trim();
if (q.length < 2) { dropCode.classList.remove('show'); return; }
acTimeout = setTimeout(() => acSearch(q, dropCode), 300);
});

document.addEventListener('click', function(e) {
if (!e.target.closest('#clientName') && !e.target.closest('#acDropdownName')) dropName.classList.remove('show');
if (!e.target.closest('#clientIdCode') && !e.target.closest('#acDropdownCode')) dropCode.classList.remove('show');
});

async function acSearch(query, dropdown) {
try {
const res = await fetch('get_realizations.php?action=clients_search&q=' + encodeURIComponent(query), { credentials: 'include' });
const json = await res.json();
if (json.success && json.data.length > 0) {
dropdown.innerHTML = json.data.map(c => {
const icon = c.client_type === 'company' ? 'ğŸ¢' : 'ğŸ‘¤';
const det = [c.id_code, c.phone, c.email].filter(x => x).join(' â€¢ ');
return `<div class="ac-item" data-client='${JSON.stringify(c).replace(/'/g,"&#39;")}' onclick="acSelect(this)">
<div class="ac-name">${icon} ${c.client_name}</div>
${det ? '<div class="ac-detail">' + det + '</div>' : ''}
</div>`;
}).join('');
dropdown.classList.add('show');
} else {
dropdown.classList.remove('show');
}
} catch(e) { dropdown.classList.remove('show'); }
}
})();

function acSelect(el) {
const c = JSON.parse(el.dataset.client);
document.getElementById('clientName').value = c.client_name || '';
document.getElementById('clientIdCode').value = c.id_code || '';
document.getElementById('clientEmail').value = c.email || document.getElementById('clientEmail').value || '';
document.getElementById('clientPhone').value = c.phone || document.getElementById('clientPhone').value || '';
// áƒ¢áƒ˜áƒáƒ˜áƒª áƒ—áƒ£ áƒáƒ¥áƒ•áƒ¡
const typeSelect = document.getElementById('clientType');
if (typeSelect && c.client_type) typeSelect.value = c.client_type;
document.getElementById('acDropdownName').classList.remove('show');
document.getElementById('acDropdownCode').classList.remove('show');
}
</script>


</body>
</html>