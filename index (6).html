<!DOCTYPE html>

<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOTEL 725 - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Sylfaen', Arial, sans-serif; background: #f5f5f5; }
        #loginPage { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #1a5490 0%, #2a6aa5 100%); }
        .login-box { background: white; padding: 50px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); width: 100%; max-width: 400px; }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header h1 { font-size: 36px; color: #1a5490; margin-bottom: 10px; letter-spacing: 2px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; }
        .form-group input:focus { outline: none; border-color: #1a5490; }
        .login-btn { width: 100%; padding: 15px; background: #1a5490; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-family: inherit; }
        .login-btn:hover { background: #0d3b6e; }
        .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .login-error { color: #e74c3c; font-size: 13px; margin-top: 10px; display: none; text-align: center; }
        .login-error.show { display: block; }
        #dashboardPage { display: none; height: 100vh; max-height: 100vh; overflow: hidden; }
        #dashboardPage.active { display: flex; }
        .sidebar { width: 280px; background: linear-gradient(180deg, #1a5490 0%, #164172 100%); color: white; display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header h1 { font-size: 28px; letter-spacing: 2px; }
        .sidebar-menu { flex: 1; padding: 20px 0; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: all 0.3s; border-left: 4px solid transparent; display: flex; align-items: center; gap: 12px; }
        .menu-item:hover { background: rgba(255,255,255,0.1); border-left-color: white; }
        .menu-item.active { background: rgba(255,255,255,0.15); border-left-color: white; font-weight: 600; }
        .sidebar-footer { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .logout-btn { width: 100%; padding: 12px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-family: inherit; font-size: 14px; }
        .logout-btn:hover { background: rgba(255,255,255,0.2); }
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100%; min-height: 100vh; overflow: hidden; }
        .topbar { background: white; padding: 20px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .content-area { flex: 1; overflow: hidden; padding: 0; margin: 0; }
        .content-area iframe { width: 100%; height: 100%; min-height: 100%; border: none; display: block; }
        .loading-message { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage">
        <div class="login-box">
            <div class="login-header">
                <h1>HOTEL 725</h1>
                <p>áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>áƒáƒáƒ áƒáƒšáƒ˜</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="login-btn" id="loginBtn">ğŸ” áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
                <div class="login-error" id="loginError"></div>
            </form>
        </div>
    </div>


<!-- Dashboard -->
<div id="dashboardPage">
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>HOTEL 725</h1>
            <p>áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒáƒœáƒ”áƒšáƒ˜</p>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item active" data-perm="bookings" onclick="loadPage('admin.html', 'áƒ¯áƒáƒ•áƒ¨áƒœáƒ”áƒ‘áƒ˜', this)">
                <span>ğŸ“‹</span><span>áƒ¯áƒáƒ•áƒ¨áƒœáƒ”áƒ‘áƒ˜</span>
            </div>
            <div class="menu-item" data-perm="new_realization" onclick="loadPage('hotel-realization-classic.html', 'áƒáƒ®áƒáƒšáƒ˜ áƒ©áƒáƒœáƒáƒ¬áƒ”áƒ áƒ˜', this)">
                <span>â•</span><span>áƒáƒ®áƒáƒšáƒ˜ áƒ©áƒáƒœáƒáƒ¬áƒ”áƒ áƒ˜</span>
            </div>
            <div class="menu-item" data-perm="realizations" onclick="loadPage('realizations-list.html', 'áƒ áƒ”áƒáƒšáƒ˜áƒ–áƒáƒªáƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ', this)">
                <span>ğŸ“Š</span><span>áƒ áƒ”áƒáƒšáƒ˜áƒ–áƒáƒªáƒ˜áƒ”áƒ‘áƒ˜</span>
            </div>
            <div class="menu-item" data-perm="blocking" onclick="loadPage('blocking-chart.html', 'Blocking Chart', this)">
                <span>ğŸ—“ï¸</span><span>Blocking Chart</span>
            </div>
            <div class="menu-item" data-perm="rooms" onclick="loadPage('rooms.html', 'áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ', this)">
                <span>ğŸšª</span><span>áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</span>
            </div>
            <div class="menu-item" data-perm="system" onclick="loadPage('system.html', 'áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ', this)">
                <span>âš™ï¸</span><span>áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ / Backup</span>
            </div>
            <div class="menu-item" data-perm="users" onclick="loadPage('users.html', 'áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜', this)">
                <span>ğŸ‘¥</span><span>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜</span>
            </div>
        </div>
        <div class="sidebar-footer">
            <div style="text-align:center; margin-bottom:10px; font-size:12px; opacity:0.7;">ğŸ‘¤ <span id="currentUser">Admin</span></div>
            <button class="logout-btn" onclick="logout()">ğŸšª áƒ’áƒáƒ¡áƒ•áƒšáƒ</button>
        </div>
    </div>

    <div class="main-content">
        <div class="topbar">
            <h2 id="pageTitle">áƒ¯áƒáƒ•áƒ¨áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
            <div>ğŸ‘¤ <span id="currentUserTop">Admin</span></div>
        </div>
        <div class="content-area">
            <div id="loadingMsg" class="loading-message">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</div>
            <iframe id="adminFrame" src="about:blank" style="display: none;"></iframe>
        </div>
    </div>
</div>

<script>
    const LOGIN_API = 'login_api.php';
    let currentPage = 'admin.html';

    // áƒ˜áƒœáƒ˜áƒªáƒ˜áƒáƒšáƒ˜áƒ–áƒáƒªáƒ˜áƒ â€” áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ–áƒ” session áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch(LOGIN_API + '?action=check', { credentials: 'include' });
            const data = await res.json();
            if (data.success && data.loggedIn) {
                showDashboard(data.user, data.role, data.permissions);
            }
        } catch (e) {
            // áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜ áƒ›áƒ˜áƒ£áƒ¬áƒ•áƒ“áƒáƒ›áƒ”áƒšáƒ˜áƒ â€” login áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ áƒ áƒ©áƒ”áƒ‘áƒ
        }
    });

    // áƒšáƒáƒ’áƒ˜áƒœáƒ˜ â€” áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ–áƒ” áƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ”áƒ‘áƒ
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const btn = document.getElementById('loginBtn');
        const errEl = document.getElementById('loginError');
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) return;
        btn.disabled = true;
        btn.textContent = 'â³ áƒ›áƒáƒ¬áƒ›áƒ“áƒ”áƒ‘áƒ...';
        errEl.classList.remove('show');

        try {
            const res = await fetch(LOGIN_API + '?action=login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ username, password })
            });
            const data = await res.json();

            if (data.success) {
                showDashboard(data.user, data.role, data.permissions);
            } else {
                errEl.textContent = data.error || 'áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜';
                errEl.classList.add('show');
            }
        } catch (e) {
            errEl.textContent = 'áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ';
            errEl.classList.add('show');
        }
        btn.disabled = false;
        btn.textContent = 'ğŸ” áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ';
    });

    let currentPermissions = {};
    let currentRole = 'admin';

    function showDashboard(username, role, permissions) {
        currentRole = role || 'admin';
        currentPermissions = permissions || {};

        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('dashboardPage').classList.add('active');
        document.getElementById('currentUser').textContent = username || 'Admin';
        document.getElementById('currentUserTop').textContent = (username || 'Admin') + ' (' + getRoleName(currentRole) + ')';
        
        // áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ˜áƒ®áƒ”áƒ“áƒ•áƒ˜áƒ— áƒ›áƒ”áƒœáƒ˜áƒ£
        applyPermissions();
        initializeIframe();

        // áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ
        const firstVisible = document.querySelector('.menu-item:not([style*="display: none"])');
        if (firstVisible) firstVisible.click();
    }

    function getRoleName(role) {
        return { admin: 'áƒáƒ“áƒ›áƒ˜áƒœáƒ˜', manager: 'áƒ›áƒ”áƒœáƒ”áƒ¯áƒ”áƒ áƒ˜', receptionist: 'áƒ áƒ”áƒªáƒ”áƒ¤áƒªáƒ˜áƒáƒœáƒ˜áƒ¡áƒ¢áƒ˜' }[role] || role;
    }

    function applyPermissions() {
        document.querySelectorAll('.menu-item[data-perm]').forEach(item => {
            const perm = item.dataset.perm;
            if (currentRole === 'admin' || currentPermissions[perm]) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function loadPage(pageSrc, title, menuEl) {
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
        if (menuEl) menuEl.classList.add('active');
        document.getElementById('pageTitle').textContent = title;
        const iframe = document.getElementById('adminFrame');
        const loadingMsg = document.getElementById('loadingMsg');
        loadingMsg.style.display = 'block';
        loadingMsg.textContent = 'â³ áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...';
        iframe.style.display = 'none';
        currentPage = pageSrc;
        iframe.src = pageSrc;
    }

    function initializeIframe() {
        const iframe = document.getElementById('adminFrame');
        const loadingMsg = document.getElementById('loadingMsg');
        iframe.onload = function() {
            setTimeout(() => { loadingMsg.style.display = 'none'; iframe.style.display = 'block'; }, 500);
        };
        iframe.onerror = function() {
            loadingMsg.innerHTML = '<div style="color:#e74c3c;text-align:center;padding:40px;"><h3>âš ï¸ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ</h3><p>' + currentPage + ' áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p></div>';
        };
    }

    async function logout() {
        if (!confirm('áƒ’áƒ¡áƒ£áƒ áƒ— áƒ’áƒáƒ¡áƒ•áƒšáƒ?')) return;
        try { await fetch(LOGIN_API + '?action=logout', { method: 'POST', credentials: 'include' }); } catch(e) {}
        location.reload();
    }
</script>


</body>
</html>